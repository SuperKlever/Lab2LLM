# Архитектура системы

Cистема представляет собой **мультиагентную сеть**, реализованную с использованием фреймворков **LangChain** и **LangGraph**.

### 1. Идея системы
Система которая в зависимости от типа запроса пользователя подберет подходящего агента для ответа.

**Система поддерживает:**
* маршрутизацию запросов между агентами,
* вызов инструментов (tool calling),
* хранение состояния и краткой памяти сессии.

**Особенности:**

* анализ входного запроса пользователя;
* классификация запроса по типу задачи;
* принятие решения о передаче управления специализированному агенту.
* использование инструментов для более точного ответа с учетом контекста запроса.

---

### 2. Агенты в системе и их роли

#### 2.1 Router / Analyzer Agent
Определяет какому агенту передать запрос пользователя

**Функции:**
* определяет intent (`explanation` или `problem_solving`);
* извлекает предметную область (например, математика, физика);

#### 2.2 Explanation Agent
Агент предназначенный для предоставления теоретических объяснений учебных тем.

**Функции:**
* формирует объяснение понятий и теории;
* адаптирует стиль ответа с учётом информации из памяти;
* при необходимости использует инструмент поиска/доступа к справочной информации.

#### 2.3 Problem Solving Agent
Агент предназначенный для решения математических задач.

**Функции:**
* использование вычислительных инструментов для получения точного результата;

---

### 3. Используемые паттерны мультиагентных систем

#### 3.1 Router + Specialized Agents

Основной архитектурный паттерн системы.

* Router Agent принимает решение о маршрутизации запроса.
* Управление передаётся одному из специализированных агентов:

  * Explanation Agent
  * Problem Solving Agent

#### 3.2 Supervisor-подобная роль (частично)

Router Agent выполняет упрощённую роль supervisor:

* контролирует поток выполнения;
* принимает решение, какой агент активен в текущем шаге;
* завершает выполнение после получения ответа.

---

### 4. Поток управления и данных

Ниже представлена диаграмма потока управления системы.

![](imgs/graph.png)

---

### 5. Использование tool calling

В системе используется два инструмента.

#### 5.1 lookup в Explanation Agent

Вызывается при необходимости, когда агенту требуется внешняя информация. Предоставляет доступ к заданной базе данных по ключевым словам в запросе.
Пример:
```json
{
    "производная": (
        "Производная показывает скорость изменения функции. Формально это предел "
        "отношения приращения функции к приращению аргумента."
    ),
    "интеграл": (
        "Интеграл — обобщение суммы бесконечно малого. Используется для вычисления "
        "площадей, объемов и накопленных величин."
    ),
    "сирус": (
        "Сирус (Пробудитель миров) — это финальный босс дополнения «Завоеватели Атласа» и лидер других четырёх завоевателей Атласа."
        "Он известен как один из самых сложных боссов в игре из-за своего высокого урона, который включает физический, стихийный (огонь, холод, молния) и урон хаосом. "
    ),
}
```

#### 5.2 calculator в Problem Solving Agent

При наличии в запросе математических выражений вычисляет их результат.

---

### 6. Управление памятью и состоянием

Для хранения контекста используется **состояние LangGraph**, общее для всей сессии.

**Хранится:**
* история последних запросов пользователя;
* текущая предметная область (`subject`);
* последний выбранный тип задачи.

Пример:
```json
{
  "subject": "mathematics",
  "level": "beginner",
  "history": ["Объясни производную", "Реши пример"]
}
```

---

# Эсперименты

---

# Рефлексия